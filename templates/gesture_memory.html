{% extends "base.html" %}

{% block title %}âˆ GESTURE MEMORY - {{ difficulty.upper() }} MODE âˆ{% endblock %}

{% block content %}
<div style="text-align: center; margin-bottom: 40px;">
    <h1 class="matrix-text">âˆ COSMIC MEMORY SEQUENCE âˆ</h1>
    <p style="color: var(--star-white); font-size: 1.1rem;">
        Remember the stellar emoji patterns as they flash across the void...
    </p>
</div>

<div class="status-display">
    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap;">
        <div class="level-display">SEQUENCE: <span id="sequence-length">1</span></div>
        <div class="score-display">SCORE: <span id="current-score">0</span></div>
        <div style="color: var(--magic-pink);">DIFFICULTY: {{ difficulty.upper() }}</div>
    </div>
</div>

<div style="background: linear-gradient(135deg, var(--space-dark), var(--universe-purple)); border: 2px solid var(--magic-pink); border-radius: 12px; padding: 25px; margin: 20px 0; text-align: center;">
    <h3 style="color: var(--magic-pink); margin-bottom: 20px;">âˆ STELLAR SEQUENCE DISPLAY âˆ</h3>
    
    <div id="sequence-display" style="font-size: 4rem; min-height: 120px; display: flex; align-items: center; justify-content: center; margin: 30px 0; background: rgba(0,0,0,0.7); border-radius: 10px;">
        Ready to begin...
    </div>
    
    <div id="phase-indicator" style="color: var(--quantum-glow); font-size: 1.2rem; margin: 20px 0;">
        PHASE: STANDBY
    </div>
</div>

<div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin: 30px 0;">
    <button class="cosmic-btn" onclick="addToSequence('ğŸŒŸ')" style="font-size: 2rem; padding: 20px;">ğŸŒŸ</button>
    <button class="cosmic-btn" onclick="addToSequence('ğŸŒ™')" style="font-size: 2rem; padding: 20px;">ğŸŒ™</button>
    <button class="cosmic-btn" onclick="addToSequence('â­')" style="font-size: 2rem; padding: 20px;">â­</button>
    <button class="cosmic-btn" onclick="addToSequence('ğŸ’«')" style="font-size: 2rem; padding: 20px;">ğŸ’«</button>
    <button class="cosmic-btn" onclick="addToSequence('ğŸŒŒ')" style="font-size: 2rem; padding: 20px;">ğŸŒŒ</button>
    <button class="cosmic-btn" onclick="addToSequence('â˜„ï¸')" style="font-size: 2rem; padding: 20px;">â˜„ï¸</button>
    <button class="cosmic-btn" onclick="addToSequence('ğŸŒ ')" style="font-size: 2rem; padding: 20px;">ğŸŒ </button>
    <button class="cosmic-btn" onclick="addToSequence('ğŸ›¸')" style="font-size: 2rem; padding: 20px;">ğŸ›¸</button>
</div>

<div style="text-align: center; margin: 30px 0;">
    <button id="start-btn" class="cosmic-btn" onclick="startGame()" style="font-size: 1.2rem;">
        <i class="fas fa-play"></i> BEGIN_SEQUENCE
    </button>
    
    <button id="reset-btn" class="cosmic-btn" onclick="resetSequence()" style="background: linear-gradient(45deg, var(--magic-pink), var(--magic-violet)); display: none;">
        <i class="fas fa-undo"></i> RESET_INPUT
    </button>
    
    <a href="/games" class="cosmic-btn" style="background: linear-gradient(45deg, var(--void-gray), var(--space-dark));">
        <i class="fas fa-arrow-left"></i> RETURN_TO_BASE
    </a>
</div>
{% endblock %}

{% block scripts %}
<script>
class GestureMemoryGame {
    constructor() {
        this.difficulty = '{{ difficulty }}';
        this.score = 0;
        this.currentSequence = [];
        this.userSequence = [];
        this.sequenceLength = 1;
        this.maxLength = this.difficulty === 'hard' ? 8 : this.difficulty === 'medium' ? 6 : 4;
        this.gameActive = false;
        
        this.emojis = ['ğŸŒŸ', 'ğŸŒ™', 'â­', 'ğŸ’«', 'ğŸŒŒ', 'â˜„ï¸', 'ğŸŒ ', 'ğŸ›¸'];
    }
    
    startGame() {
        this.gameActive = true;
        this.generateSequence();
        this.showSequence();
        document.getElementById('start-btn').style.display = 'none';
    }
    
    generateSequence() {
        this.currentSequence = [];
        for (let i = 0; i < this.sequenceLength; i++) {
            const randomEmoji = this.emojis[Math.floor(Math.random() * this.emojis.length)];
            this.currentSequence.push(randomEmoji);
        }
        document.getElementById('sequence-length').textContent = this.sequenceLength;
    }
    
    showSequence() {
        document.getElementById('phase-indicator').textContent = 'PHASE: MEMORIZE';
        let index = 0;
        
        const showNext = () => {
            if (index < this.currentSequence.length) {
                document.getElementById('sequence-display').textContent = this.currentSequence[index];
                document.getElementById('sequence-display').style.transform = 'scale(1.2)';
                document.getElementById('sequence-display').style.color = 'var(--quantum-glow)';
                
                setTimeout(() => {
                    document.getElementById('sequence-display').style.transform = 'scale(1)';
                    document.getElementById('sequence-display').style.color = 'var(--star-white)';
                    document.getElementById('sequence-display').textContent = '...';
                    index++;
                    setTimeout(showNext, 500);
                }, 800);
            } else {
                document.getElementById('phase-indicator').textContent = 'PHASE: RECALL SEQUENCE';
                document.getElementById('sequence-display').textContent = 'Enter the sequence...';
                document.getElementById('reset-btn').style.display = 'inline-block';
                this.userSequence = [];
            }
        };
        
        showNext();
    }
    
    addToSequence(emoji) {
        if (!this.gameActive) return;
        
        this.userSequence.push(emoji);
        document.getElementById('sequence-display').textContent = this.userSequence.join(' ');
        
        // Check if sequence is complete
        if (this.userSequence.length === this.currentSequence.length) {
            setTimeout(() => this.checkSequence(), 500);
        }
    }
    
    checkSequence() {
        const correct = this.userSequence.every((emoji, index) => emoji === this.currentSequence[index]);
        
        if (correct) {
            const roundScore = Math.floor((this.sequenceLength * 50) * (this.difficulty === 'hard' ? 2 : this.difficulty === 'medium' ? 1.5 : 1));
            this.score += roundScore;
            document.getElementById('current-score').textContent = this.score;
            
            this.showFeedback(`âœ¨ SEQUENCE CORRECT! +${roundScore} points`, 'success');
            
            if (this.sequenceLength >= this.maxLength) {
                setTimeout(() => this.endGame(), 2000);
            } else {
                this.sequenceLength++;
                setTimeout(() => {
                    this.generateSequence();
                    this.showSequence();
                }, 2000);
            }
        } else {
            this.showFeedback("âŒ SEQUENCE INCORRECT! Game Over.", 'error');
            setTimeout(() => this.endGame(), 2000);
        }
    }
    
    resetSequence() {
        this.userSequence = [];
        document.getElementById('sequence-display').textContent = 'Enter the sequence...';
    }
    
    showFeedback(message, type) {
        const feedback = document.createElement('div');
        feedback.textContent = message;
        feedback.style.cssText = `
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: ${type === 'success' ? 'var(--terminal-green)' : 'var(--magic-pink)'};
            color: var(--cosmic-black); padding: 20px 30px; border-radius: 10px;
            font-weight: bold; z-index: 2000; font-size: 1.2rem;
            box-shadow: 0 0 40px ${type === 'success' ? 'var(--terminal-green)' : 'var(--magic-pink)'};
        `;
        
        document.body.appendChild(feedback);
        setTimeout(() => document.body.removeChild(feedback), 2000);
    }
    
    endGame() {
        showCosmicSuccess('Gesture Memory', this.score, 
            `You remembered sequences up to length ${this.sequenceLength - 1}! Memory protocol complete.`);
    }
}

let gameInstance;

function startGame() {
    gameInstance = new GestureMemoryGame();
    gameInstance.startGame();
}

function addToSequence(emoji) {
    if (gameInstance) {
        gameInstance.addToSequence(emoji);
    }
}

function resetSequence() {
    if (gameInstance) {
        gameInstance.resetSequence();
    }
}
</script>
{% endblock %}
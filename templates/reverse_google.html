{% extends "base.html" %}

{% block title %}∎ REVERSE GOOGLE - {{ difficulty.upper() }} MODE ∎{% endblock %}

{% block content %}
<div style="text-align: center; margin-bottom: 40px;">
    <h1 class="matrix-text">∎ REVERSE GOOGLE PROTOCOL ∎</h1>
    <p style="color: var(--star-white); font-size: 1.1rem;">
        Decode cryptic word puzzles transmitted from the cosmic void...
    </p>
</div>

<div class="status-display">
    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap;">
        <div class="level-display">ROUND: <span id="current-round">1</span> / <span id="total-rounds">5</span></div>
        <div class="score-display">SCORE: <span id="current-score">0</span></div>
        <div style="color: var(--magic-pink);">DIFFICULTY: {{ difficulty.upper() }}</div>
    </div>
</div>

<div style="background: linear-gradient(135deg, var(--space-dark), var(--universe-purple)); border: 2px solid var(--terminal-green); border-radius: 12px; padding: 25px; margin: 20px 0; text-align: center;">
    <h3 style="color: var(--quantum-glow); margin-bottom: 20px;">∎ ENCRYPTED CLUE RECEIVED ∎</h3>
    <div id="clue-display" style="color: var(--star-white); font-size: 1.3rem; margin-bottom: 20px; font-family: 'Courier New';">
        Loading cosmic transmission...
    </div>
    
    <input type="text" 
           id="answer-input" 
           class="cosmic-input" 
           placeholder="ENTER_DECODE_KEY..."
           style="margin: 20px 0;"
           autocomplete="off">
    
    <div style="margin: 20px 0;">
        <button id="submit-btn" class="cosmic-btn">
            <i class="fas fa-unlock"></i> DECRYPT_MESSAGE
        </button>
        
        <button id="hint-btn" class="cosmic-btn" style="background: linear-gradient(45deg, var(--magic-cyan), var(--nebula-blue));">
            <i class="fas fa-lightbulb"></i> REQUEST_HINT
        </button>
    </div>
    
    <div id="hint-display" style="display: none; background: rgba(0, 0, 0, 0.8); border: 1px dashed var(--magic-cyan); border-radius: 8px; padding: 15px; margin: 20px 0; color: var(--magic-cyan);">
        <p id="hint-text"></p>
    </div>
</div>

<div style="text-align: center; margin: 30px 0;">
    <button id="skip-btn" class="cosmic-btn" style="background: linear-gradient(45deg, var(--magic-pink), var(--magic-violet));">
        <i class="fas fa-forward"></i> SKIP_ROUND
    </button>
    
    <a href="/games" class="cosmic-btn" style="background: linear-gradient(45deg, var(--void-gray), var(--space-dark));">
        <i class="fas fa-arrow-left"></i> RETURN_TO_BASE
    </a>
</div>

<div style="text-align: center; color: var(--terminal-green); font-family: 'Courier New'; margin-top: 40px;">
    <p>$ reverse_google_active: true</p>
    <p>$ decryption_protocol: standby</p>
    <p>$ difficulty_mode: {{ difficulty }}</p>
</div>
{% endblock %}

{% block scripts %}
<script>
class ReverseGoogleGame {
    constructor() {
        this.difficulty = '{{ difficulty }}';
        this.currentRound = 1;
        this.score = 0;
        this.hintsUsed = 0;
        
        const diffSettings = this.getDifficultySettings();
        this.totalRounds = diffSettings.rounds;
        
        this.words = {
            easy: [
                { word: "APPLE", clue: "Red fruit that keeps the doctor away", hint: "Think healthy eating" },
                { word: "BOOK", clue: "Paper knowledge holder with many pages", hint: "You read this" },
                { word: "CAR", clue: "Four-wheeled transport machine", hint: "Motor vehicle" },
                { word: "DOG", clue: "Man's best friend that barks", hint: "Popular pet" },
                { word: "HOUSE", clue: "Building where families live", hint: "Your home" }
            ],
            medium: [
                { word: "RAINBOW", clue: "Colorful arc after rain and sun meet", hint: "Seven colors in the sky" },
                { word: "PIANO", clue: "Musical instrument with black and white keys", hint: "You play it with fingers" },
                { word: "BUTTERFLY", clue: "Colorful insect that was once a caterpillar", hint: "It flies and transforms" },
                { word: "TELESCOPE", clue: "Device that makes distant objects appear closer", hint: "Astronomers use this" },
                { word: "VOLCANO", clue: "Mountain that can explode with hot lava", hint: "It erupts" }
            ],
            hard: [
                { word: "DEMOCRACY", clue: "Government system where people choose their leaders", hint: "Political system with voting" },
                { word: "METAMORPHOSIS", clue: "Complete transformation from one form to another", hint: "Caterpillar to butterfly process" },
                { word: "ARCHAEOLOGY", clue: "Study of human history through excavation", hint: "Digging up ancient artifacts" },
                { word: "PHOTOSYNTHESIS", clue: "Process plants use to make food from sunlight", hint: "How plants eat light" },
                { word: "CONSTELLATION", clue: "Group of stars forming recognizable pattern", hint: "Star patterns in the sky" }
            ]
        };
        
        this.currentWord = null;
        this.init();
    }
    
    getDifficultySettings() {
        const settings = {
            easy: { rounds: 3 },
            medium: { rounds: 5 },
            hard: { rounds: 7 }
        };
        return settings[this.difficulty] || settings.medium;
    }
    
    init() {
        document.getElementById('total-rounds').textContent = this.totalRounds;
        this.setupEventListeners();
        this.nextRound();
    }
    
    setupEventListeners() {
        document.getElementById('submit-btn').addEventListener('click', () => this.checkAnswer());
        document.getElementById('hint-btn').addEventListener('click', () => this.showHint());
        document.getElementById('skip-btn').addEventListener('click', () => this.skipRound());
        document.getElementById('answer-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') this.checkAnswer();
        });
    }
    
    nextRound() {
        if (this.currentRound > this.totalRounds) {
            this.endGame();
            return;
        }
        
        const wordPool = this.words[this.difficulty];
        this.currentWord = wordPool[Math.floor(Math.random() * wordPool.length)];
        
        document.getElementById('current-round').textContent = this.currentRound;
        document.getElementById('clue-display').textContent = this.currentWord.clue;
        document.getElementById('answer-input').value = '';
        document.getElementById('hint-display').style.display = 'none';
        document.getElementById('answer-input').focus();
        
        this.hintsUsed = 0;
    }
    
    checkAnswer() {
        const userAnswer = document.getElementById('answer-input').value.trim().toUpperCase();
        
        if (!userAnswer) {
            this.showFeedback("Please enter your answer!", 'warning');
            return;
        }
        
        if (userAnswer === this.currentWord.word) {
            const roundScore = Math.floor((100 - (this.hintsUsed * 20)) * (this.difficulty === 'hard' ? 2 : this.difficulty === 'medium' ? 1.5 : 1));
            this.score += Math.max(10, roundScore);
            document.getElementById('current-score').textContent = this.score;
            
            this.showFeedback("✨ TRANSMISSION DECODED! ✨", 'success');
            
            setTimeout(() => {
                this.currentRound++;
                this.nextRound();
            }, 2000);
            
        } else {
            this.showFeedback("❌ DECRYPTION FAILED - Try again!", 'error');
        }
    }
    
    showHint() {
        if (this.hintsUsed >= 1) {
            this.showFeedback("No more hints available!", 'warning');
            return;
        }
        
        this.hintsUsed++;
        document.getElementById('hint-text').textContent = this.currentWord.hint;
        document.getElementById('hint-display').style.display = 'block';
    }
    
    skipRound() {
        if (confirm('Skip this cosmic transmission?')) {
            this.showFeedback(`The answer was: ${this.currentWord.word}`, 'info');
            setTimeout(() => {
                this.currentRound++;
                this.nextRound();
            }, 2000);
        }
    }
    
    showFeedback(message, type) {
        const feedback = document.createElement('div');
        feedback.textContent = message;
        feedback.style.cssText = `
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: ${type === 'success' ? 'var(--terminal-green)' : type === 'error' ? 'var(--magic-pink)' : 'var(--magic-cyan)'};
            color: var(--cosmic-black); padding: 15px 30px; border-radius: 10px;
            font-weight: bold; z-index: 2000;
            box-shadow: 0 0 30px ${type === 'success' ? 'var(--terminal-green)' : type === 'error' ? 'var(--magic-pink)' : 'var(--magic-cyan)'};
        `;
        
        document.body.appendChild(feedback);
        setTimeout(() => document.body.removeChild(feedback), 2000);
    }
    
    endGame() {
        showCosmicSuccess('Reverse Google', this.score, 
            `You decoded ${this.currentRound - 1} cosmic transmissions! Mission complete!`);
    }
}

document.addEventListener('DOMContentLoaded', function() {
    new ReverseGoogleGame();
});
</script>
{% endblock %}